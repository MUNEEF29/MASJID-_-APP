<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ app_settings.get('app_name', config.APP_NAME) }}{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    {% if current_user.is_authenticated %}
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('dashboard.index') }}">
                <div class="mosque-logo">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: 24px; fill: white;">
                        <path d="M50 5 C50 5 65 20 65 35 L65 45 L75 45 L75 35 C75 35 80 30 85 35 L85 45 L90 45 L90 95 L10 95 L10 45 L15 45 L15 35 C20 30 25 35 25 35 L25 45 L35 45 L35 35 C35 20 50 5 50 5 Z"/>
                        <circle cx="50" cy="30" r="8"/>
                    </svg>
                </div>
                <div>
                    <span>{{ app_settings.get('app_name', config.APP_NAME) }}</span>
                    <small class="d-none d-lg-block" style="font-size: 0.7rem; color: var(--primary-gold); font-family: 'Amiri', serif;">{{ app_settings.get('app_name_arabic', config.APP_NAME_ARABIC) }}</small>
                </div>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('dashboard.index') }}">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                            <i class="bi bi-cash-stack"></i> Income
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('income.index') }}"><i class="bi bi-list-ul me-2"></i>View All</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('income.create') }}"><i class="bi bi-plus-circle me-2"></i>New Entry</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                            <i class="bi bi-credit-card"></i> Expenses
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('expenses.index') }}"><i class="bi bi-list-ul me-2"></i>View All</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('expenses.create') }}"><i class="bi bi-plus-circle me-2"></i>New Entry</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                            <i class="bi bi-journal-text"></i> Accounts
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('accounts.index') }}"><i class="bi bi-diagram-3 me-2"></i>Chart of Accounts</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('accounts.trial_balance') }}"><i class="bi bi-calculator me-2"></i>Trial Balance</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('accounts.income_expenditure') }}"><i class="bi bi-graph-up-arrow me-2"></i>Income & Expenditure</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('accounts.balance_sheet') }}"><i class="bi bi-file-spreadsheet me-2"></i>Balance Sheet</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                            <i class="bi bi-file-earmark-bar-graph"></i> Reports
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('reports.index') }}"><i class="bi bi-grid me-2"></i>Report Center</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('reports.daily') }}"><i class="bi bi-calendar-day me-2"></i>Daily Report</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('reports.monthly') }}"><i class="bi bi-calendar-month me-2"></i>Monthly Report</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('reports.fund_summary') }}"><i class="bi bi-pie-chart me-2"></i>Fund Summary</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                            <i class="bi bi-gear"></i> Settings
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('admin.settings') }}"><i class="bi bi-sliders me-2"></i>App Settings</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('admin.period_locks') }}"><i class="bi bi-lock me-2"></i>Period Locks</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('admin.audit_log') }}"><i class="bi bi-clock-history me-2"></i>Activity Log</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('ai_assistant.index') }}" title="Islamic AI Assistant">
                            <i class="bi bi-robot"></i> AI Assistant
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item d-none d-lg-flex align-items-center me-3">
                        <span class="nav-link text-light py-1 px-2" style="font-size: 0.8rem; background: rgba(255,255,255,0.1); border-radius: 6px;">
                            <i class="bi bi-clock me-1"></i>
                            <span id="live-datetime"></span>
                        </span>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle"></i> {{ current_user.full_name }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="{{ url_for('auth.profile') }}"><i class="bi bi-person me-2"></i>Profile</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    {% endif %}

    <main class="container-fluid py-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show animate-fade-in" role="alert">
                    <i class="bi bi-{% if category == 'success' %}check-circle{% elif category == 'danger' %}exclamation-triangle{% elif category == 'warning' %}exclamation-circle{% else %}info-circle{% endif %} me-2"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <footer class="footer">
        <div class="container">
            <span class="footer-brand">{{ app_settings.get('app_name', config.APP_NAME) }}</span>
            <span class="d-block" style="font-family: 'Amiri', serif; font-size: 0.8rem;">{{ app_settings.get('app_name_arabic', config.APP_NAME_ARABIC) }}</span>
            <span>Islamic Accounting System {{ now().year if now is defined else '2024' }}</span>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
    function updateLiveDateTime() {
        const now = new Date();
        const options = { 
            weekday: 'short', 
            day: '2-digit', 
            month: 'short', 
            year: 'numeric',
            hour: '2-digit', 
            minute: '2-digit', 
            second: '2-digit',
            hour12: true
        };
        const formatted = now.toLocaleDateString('en-US', options);
        const el = document.getElementById('live-datetime');
        if (el) el.textContent = formatted;
    }
    updateLiveDateTime();
    setInterval(updateLiveDateTime, 1000);
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
